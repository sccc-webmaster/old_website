var lgWidget={categories:[],portlets:[],showTimer:0,init:function(){var a=this;var d=jQuery("#portal_add_content");a.menu=d;if(d.length){a.portlets=d.find(".lfr-portlet-item");a.categories=d.find(".lfr-content-category");a.categoryContainers=d.find(".lfr-add-content");var b=function(){var e=jQuery(this).attr("id");return Liferay.Util.uncamelize(e).toLowerCase()};var c=jQuery("#layout_configuration_content");c.liveSearch({list:a.portlets,data:b,show:function(){var e=jQuery(this);e.show();jQuery(".portal-add-content").addClass("portal-add-content-change-ui");e.parents(".lfr-content-category").addClass("visible lfr-content-category-change-ui").removeClass("hidden").show();e.parents(".lfr-add-content").addClass("expanded lfr-add-content-change-ui").removeClass("collapsed").show()},hide:function(){var e=jQuery(this);e.hide()}});c.liveSearch({list:a.categoryContainers,data:b,after:function(){if(!this.term){jQuery(".portal-add-content").removeClass("portal-add-content-change-ui");a.categories.addClass("hidden").removeClass("visible lfr-content-category-change-ui").css("display","");a.categoryContainers.addClass("collapsed").removeClass("expanded lfr-add-content-change-ui").css("display","");a.portlets.css("display","");jQuery(".lfr-content-category:first").removeClass("hidden").addClass("visible");jQuery(".lfr-add-content:first").removeClass("collapsed").addClass("expanded")}if(this.term=="*"){a.categories.addClass("visible").removeClass("hidden");a.categoryContainers.addClass("expanded").removeClass("collapsed");a.portlets.show()}},exclude:function(){var f=jQuery(".lfr-content-category",this);var e=f.find("> div:visible").length;return e>0}})}},toggle:function(g,f){var c=this;var d=themeDisplay.getPlid();var b=themeDisplay.getDoAsUserIdEncoded();if(!c.menu){var e=themeDisplay.getPathMain()+"/portal/render_portlet";if(f){var h=250;var a=jQuery("body");c._dialog=Liferay.Popup({width:h,message:'<div class="loading-animation" />',position:[4,33],resizable:false,title:Liferay.Language.get("add-application"),onClose:function(){c.menu=null;a.removeClass("lfr-has-sidebar")}})}else{c._dialog=jQuery("#widgets-content")}jQuery.ajax({url:e,data:{p_l_id:d,p_p_id:g,p_p_state:"exclusive",doAsUserId:b},success:function(i){i=i.replace("lfr-auto-focus","");c._dialog.html(i);c._loadContent();jQuery(".lfr-content-category:first").removeClass("hidden").addClass("visible");jQuery(".lfr-add-content:first").removeClass("collapsed").addClass("expanded")}})}},_addPortlet:function(i,m){var j=this;var e=j._getPortletMetaData(i);if(!e.portletUsed){var c=e.plid;var f=e.portletId;var h=e.instanceable;if(!h){i.addClass("lfr-portlet-used");i.draggable("disable")}var g=jQuery('<div class="loading-animation" />');var b=null;var d=null;if(m){var l=m.item;m.placeHolder=g[0];b=m.onComplete;d=m.beforePortletLoaded;l.after(g);l.remove()}else{if(j._sortColumns){j._sortColumns.filter(":first").prepend(g)}}var a={beforePortletLoaded:d,onComplete:b,plid:c,portletId:f,placeHolder:g};var k=Liferay.Portlet.add(a);j._loadPortletFiles(e)}},_getPortletMetaData:function(j){var k=this;var f=j._LFR_portletMetaData;if(!f){var d=(j.attr("instanceable")=="true");var c=j.attr("plid");var h=j.attr("portletId");var g=j.is(".lfr-portlet-used");var e=(j.attr("headerPortalCssPaths")||"").split(",");var i=(j.attr("headerPortletCssPaths")||"").split(",");var a=(j.attr("footerPortalCssPaths")||"").split(",");var b=(j.attr("footerPortletCssPaths")||"").split(",");f={instanceable:d,plid:c,portletId:h,portletPaths:{footer:b,header:i},portalPaths:{footer:a,header:e},portletUsed:g};j._LFR_portletMetaData=f}return f},_loadContent:function(){var a=this;a.init();Liferay.Util.addInputType();Liferay.bind("closePortlet",a._onPortletClose,a);a._portletItems=a._dialog.find("div.lfr-portlet-item");var d=a._portletItems;d.find("a").click(function(i){var h=jQuery(this);var j=h.parents(".lfr-portlet-item:first");a._addPortlet(j)});var g=a._dialog.parents(".ui-dialog").css("z-index");a._helper=jQuery(Liferay.Template.PORTLET).css("z-index",g+10);a._helper.addClass("ui-proxy generic-portlet not-intersecting");var f="Column";var e="body";if(Liferay.Layout.isFreeForm){e="#column-1";f="FreeForm"}else{if(!a._sortColumns||!a._sortableInstance){a._sortColumns=Liferay.Layout.Columns.sortColumns;a._sortableInstance=a._sortColumns.data("sortable")}var c=a._sortColumns;var b=a._sortableInstance;b.refresh();if(!a._eventsBound){c.bind("sortreceive.sortable",function(i,j){if(j.item.is(".lfr-portlet-item")&&j.sender.is(".lfr-portlet-item")&&!b.dragging){var l=j.item;var k=j.sender;var h={item:l};a._addPortlet(k,h);l.hide()}});c.bind("sortactivate.sortable",function(h){Liferay.Layout.Columns.startDragging();b.refreshPositions(true)});c.bind("sortstart.sortable",function(h,i){if(i.item.is(".lfr-portlet-item")){i.placeholder.css({height:200,width:300})}});a._eventsBound=true}}a._dragOptions={appendTo:e,connectToSortable:".lfr-portlet-column",distance:2,helper:function(i){var h=a._helper.clone();var j=this.getAttribute("title");h.find(".portlet-title").text(j);return h[0]},start:function(h,i){if(a["_on"+f+"DragStart"]){a["_on"+f+"DragStart"](h,i,this)}},drag:function(h,i){if(a["_on"+f+"Drag"]){a["_on"+f+"Drag"](h,i,this)}},stop:function(h,i){if(a["_on"+f+"DragStop"]){a["_on"+f+"DragStop"](h,i,this)}}};d.draggable(a._dragOptions);d.filter(".lfr-portlet-used").draggable("disable");if(Liferay.Browser.isIe()){d.hover(function(){this.className+=" over"},function(){this.className=this.className.replace("over","")})}jQuery(".lfr-add-content > h2").click(function(){var i=jQuery(this).parent();var h=i.find("> .lfr-content-category");jQuery(this).parent().siblings(".lfr-add-content").removeClass("expanded").addClass("collapsed");jQuery(this).parent().siblings(".lfr-add-content").children(".lfr-content-category").removeClass("visible").addClass("hidden");h.toggleClass("hidden").toggleClass("visible");i.toggleClass("collapsed").toggleClass("expanded")})},_loadPortletFiles:function(f){var j=this;var c=f.portalPaths.header;var a=f.portalPaths.footer;var i=f.portletPaths.header;var b=f.portletPaths.footer;var h=jQuery("head");var d=jQuery(document.body);var g=c.concat(i);var e=a.concat(b);jQuery.each(g,function(k,l){h.prepend('<link href="'+this+'" rel="stylesheet" type="text/css" />')});if(Liferay.Browser.isIe()){jQuery("body link").appendTo("head");jQuery("link.lfr-css-file").each(function(k){document.createStyleSheet(this.href)})}jQuery.each(e,function(k,l){d.append('<link href="'+this+'" rel="stylesheet" type="text/css" />')})},_onColumnDragStop:function(b,c,d){var a=this;Liferay.Layout.Columns.stopDragging()},_onFreeFormDragStart:function(b,c,d){var a=this;c.helper.removeClass("not-intersecting")},_onFreeFormDragStop:function(b,f,d){var h=this;var g=jQuery(d);var c=f.helper;var e=f.position;var a={height:f.helper.height(),position:"absolute",width:f.helper.width()};var i={beforePortletLoaded:function(j){j=jQuery(j);j.css(e);j.css(a)},item:c,onComplete:function(k,j){jQuery(k).css(e);Liferay.Layout.FreeForm._moveToTop(k);Liferay.Layout.FreeForm._savePosition(k)}};h._addPortlet(g,i)},_onPortletClose:function(e,c){var a=this;var b=jQuery("#portal_add_content");var d=b.find(".lfr-portlet-item[plid="+c.plid+"][portletId="+c.portletId+"][instanceable=false]");if(d.is(".lfr-portlet-used")){d.removeClass("lfr-portlet-used");d.draggable("enable")}}};var lgLayouts={init:function(){var a=this},toggle:function(f,e){var b=this;var c=themeDisplay.getPlid();var a=themeDisplay.getDoAsUserIdEncoded();if(!b.menu){var d=themeDisplay.getPathMain()+"/layout_configuration/templates";b._dialog=jQuery("#load-layouts");jQuery.ajax({url:d,data:{p_l_id:c,p_p_id:f,p_p_state:"exclusive",doAsUserId:a},success:function(g){b._dialog.html(g);jQuery("#load-layouts table").replaceWith(jQuery("#load-layouts table").html().replace(/<tbody/gi,"<div id='layoutTable' role='radiogroup'  aria-labelledby='layoutTable'").replace(/<tr/gi,"<div ").replace(/<\/tr>/gi,"</div>").replace(/<td/gi,"<span").replace(/<\/td>/gi,"</span>").replace(/<\/tbody/gi,"</div"))}})}},};